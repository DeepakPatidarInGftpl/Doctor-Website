"use strict";(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[66775],{66775:(T,d,r)=>{r.r(d),r.d(d,{PaymentModule:()=>O});var F=r(36895),c=r(4392),l=r(80529),t=r(24006),u=r(39300),h=r(71884),y=r(78372),_=r(18505),v=r(63900),g=r(70262),P=r(28746),s=r(94650),f=r(76396),b=r(97185),k=r(1809),V=r(54270),I=r(80927);const N=["tabGroup"],S=[{path:"",component:(()=>{class p{constructor(e,a,n,i,o,J,L){this.billHoldService=e,this.fb=a,this.toastr=n,this.syncService=i,this.http=o,this.cartService=J,this.coreService=L,this.voucherType=[{id:1,label:"Sales",value:"sales"},{id:2,label:"Purchase",value:"purchase"},{id:3,label:"Expense",value:"expense"},{id:4,label:"Cash in Hand",value:"cash in hand"}],this.paymentType=[{id:1,label:"Advance Payment",value:"Advance"},{id:2,label:"Against Bill",value:"Against Bill"}],this.paymentMode=[{id:1,label:"UPI",value:"UPI"},{id:2,label:"Card",value:"Card"},{id:3,label:"Cash",value:"Cash"},{id:4,label:"Bank",value:"Bank"}],this.receiptSales=[],this.companyBankList=[],this.partyIsLoading=!1,this.cusMinLengthTerm=3,this.cusIsLoading=!1,this.customerAutoCompleteControl2=new t.NI("")}ngOnInit(){this.recieptForm=this.fb.group({customer:new t.NI("",[t.kI.required]),receipt_method:new t.NI("",[t.kI.required]),payment_mode:new t.NI("",[t.kI.required]),amount:new t.NI("",[t.kI.required]),description:new t.NI("",[t.kI.required]),bill_no:new t.NI("",[t.kI.required]),card_detail:new t.NI("",[t.kI.required]),bank_detail:new t.NI("",[t.kI.required]),upi_detail:new t.NI("",[t.kI.required])});const n={headers:new l.WM({"Content-Type":"application/json",Authorization:"Token 4d586523c3dbbc989192bec34006e72a4edebf00"})};this.receiptPaymentForm=this.fb.group({voucher_type:["",[t.kI.required]],payment_type:[""],payment_mode:[""],receipt_sales:[""],amount_receipt:[""],customer_receipt:[""],party_receipt:[""],receipt_remark:[""],payment_account:[""],upi_id:[""],customer_bank_name:[""],card_payment_amount:[""],card_holder_name:[""],cart_transactions_no:[""],account_no:[""],non_gst:[!1]}),this.receiptPaymentForm.get("voucher_type").valueChanges.subscribe(i=>{"sales"===i?(this.receiptPaymentForm.get("payment_type").setValue(this.paymentType[0].value),this.receiptPaymentForm.get("payment_type").setValidators(t.kI.required),this.receiptPaymentForm.get("payment_mode").setValidators(t.kI.required),this.receiptPaymentForm.get("customer_receipt").setValidators(t.kI.required),this.receiptPaymentForm.get("amount_receipt").setValidators(t.kI.required),this.receiptPaymentForm.get("payment_account").setValidators(t.kI.required),this.receiptPaymentForm.get("receipt_remark").setValidators(t.kI.required)):"purchase"===i?(this.receiptPaymentForm.get("payment_type").setValue(this.paymentType[0].value),this.receiptPaymentForm.get("payment_type").setValidators(t.kI.required),this.receiptPaymentForm.get("payment_mode").setValidators(t.kI.required),this.receiptPaymentForm.get("party_receipt").setValidators(t.kI.required),this.receiptPaymentForm.get("receipt_remark").setValidators(t.kI.required),this.receiptPaymentForm.get("amount_receipt").setValidators(t.kI.required),this.receiptPaymentForm.get("payment_account").setValidators(t.kI.required)):"expense"===i?(this.receiptPaymentForm.get("upi_id").clearValidators(),this.receiptPaymentForm.get("payment_account").setValidators(t.kI.required),this.receiptPaymentForm.get("receipt_remark").setValidators(t.kI.required),this.receiptPaymentForm.get("non_gst").setValidators(t.kI.required),this.receiptPaymentForm.get("party_receipt").setValidators(t.kI.required),this.receiptPaymentForm.get("amount_receipt").setValidators(t.kI.required)):(this.receiptPaymentForm.get("payment_type").clearValidators(),this.receiptPaymentForm.get("payment_mode").clearValidators(),this.receiptPaymentForm.get("customer_receipt").clearValidators(),this.receiptPaymentForm.get("amount_receipt").clearValidators(),this.receiptPaymentForm.get("payment_account").clearValidators(),this.receiptPaymentForm.get("receipt_remark").clearValidators()),this.receiptPaymentForm.get("party_receipt").updateValueAndValidity(),this.receiptPaymentForm.get("non_gst").updateValueAndValidity(),this.receiptPaymentForm.get("payment_type").updateValueAndValidity(),this.receiptPaymentForm.get("payment_mode").updateValueAndValidity(),this.receiptPaymentForm.get("payment_account").updateValueAndValidity(),this.receiptPaymentForm.get("customer_receipt").updateValueAndValidity(),this.receiptPaymentForm.get("receipt_remark").updateValueAndValidity(),this.receiptPaymentForm.get("amount_receipt").updateValueAndValidity()}),this.receiptPaymentForm.get("payment_type").valueChanges.subscribe(i=>{this.receiptPaymentForm.get("payment_mode").setValue(this.paymentMode[0].value),"Against Bill"===i?this.receiptPaymentForm.get("receipt_sales").setValidators(t.kI.required):this.receiptPaymentForm.get("receipt_sales").clearValidators(),this.receiptPaymentForm.get("receipt_sales").updateValueAndValidity()}),this.receiptPaymentForm.get("payment_mode").valueChanges.subscribe(i=>{"UPI"===i?(this.receiptPaymentForm.get("upi_id").setValidators(t.kI.required),this.receiptPaymentForm.get("payment_account").setValidators(t.kI.required)):"Card"===i?(this.receiptPaymentForm.get("customer_bank_name").setValidators(t.kI.required),this.receiptPaymentForm.get("card_payment_amount").setValidators(t.kI.required),this.receiptPaymentForm.get("card_holder_name").setValidators(t.kI.required),this.receiptPaymentForm.get("cart_transactions_no").setValidators(t.kI.required),this.receiptPaymentForm.get("payment_account").setValidators(t.kI.required)):"Bank"===i?this.receiptPaymentForm.get("account_no").setValidators(t.kI.required):(this.receiptPaymentForm.get("upi_id").clearValidators(),this.receiptPaymentForm.get("payment_account").clearValidators(),this.receiptPaymentForm.get("customer_bank_name").clearValidators(),this.receiptPaymentForm.get("card_payment_amount").clearValidators(),this.receiptPaymentForm.get("card_holder_name").clearValidators(),this.receiptPaymentForm.get("cart_transactions_no").clearValidators(),this.receiptPaymentForm.get("account_no").clearValidators()),this.receiptPaymentForm.get("upi_id").updateValueAndValidity(),this.receiptPaymentForm.get("payment_account").updateValueAndValidity(),this.receiptPaymentForm.get("customer_bank_name").updateValueAndValidity(),this.receiptPaymentForm.get("card_payment_amount").updateValueAndValidity(),this.receiptPaymentForm.get("card_holder_name").updateValueAndValidity(),this.receiptPaymentForm.get("cart_transactions_no").updateValueAndValidity(),this.receiptPaymentForm.get("account_no").updateValueAndValidity()}),this.receiptPaymentForm.get("customer_receipt").valueChanges.pipe((0,u.h)(i=>null!==i&&i?.length>=this.cusMinLengthTerm),(0,h.x)(),(0,y.b)(100),(0,_.b)(()=>{this.cusErrorMsg="",this.filteredCustomer2=[],this.cusIsLoading=!0}),(0,v.w)(i=>this.http.get(`https://pv.greatfuturetechno.com/pv-api/pos/customer_filter/?search=${i}`,n).pipe((0,g.K)(o=>(this.cusErrorMsg="No Customer Found",this.cusIsLoading=!1,[])),(0,P.x)(()=>{this.cusIsLoading=!1})))).subscribe(i=>{i.length>0?this.filteredCustomer2=i:(this.filteredCustomer2=[],this.cusErrorMsg="No Customers Found")}),this.receiptPaymentForm.get("party_receipt").valueChanges.pipe((0,u.h)(i=>null!==i&&i?.length>=this.cusMinLengthTerm),(0,h.x)(),(0,y.b)(100),(0,_.b)(()=>{this.partyErrorMsg="",this.filteredParty=[],this.partyIsLoading=!0}),(0,v.w)(i=>this.http.get(`https://pv.greatfuturetechno.com/pv-api/pos/party_filter/?search=${i}`,n).pipe((0,g.K)(o=>(this.partyErrorMsg="No Party Found",this.partyIsLoading=!1,[])),(0,P.x)(()=>{this.partyIsLoading=!1})))).subscribe(i=>{i.length>0?this.filteredParty=i:(this.filteredParty=[],this.partyErrorMsg="No Party Found")}),this.cartService.getCompanyBank().subscribe({next:i=>{this.companyBankList=i},error:i=>{}})}optionSelectedParty(e){}optionSelectedReceipt(e){this.cartService.getReceiptDueOrder(e.option.value.id).subscribe({next:n=>{this.receiptSales=n},error:n=>{}})}displayCus(e){return e?e.mobile_no:""}displayParty(e){return e?e.mobile_no:""}get voucher_type(){return this.receiptPaymentForm.get("voucher_type")}get payment_type(){return this.receiptPaymentForm.get("payment_type")}get payment_mode(){return this.receiptPaymentForm.get("payment_mode")}get receipt_sales(){return this.receiptPaymentForm.get("receipt_sales")}get amount_receipt(){return this.receiptPaymentForm.get("amount_receipt")}get customer_receipt(){return this.receiptPaymentForm.get("customer_receipt")}get receipt_remark(){return this.receiptPaymentForm.get("receipt_remark")}get party_receipt(){return this.receiptPaymentForm.get("party_receipt")}get receipt_customer_bank_name(){return this.receiptPaymentForm.get("customer_bank_name")}get receipt_card_payment_amount(){return this.receiptPaymentForm.get("card_payment_amount")}get receipt_card_holder_name(){return this.receiptPaymentForm.get("card_holder_name")}get receipt_cart_transactions_no(){return this.receiptPaymentForm.get("cart_transactions_no")}get receipt_account_no(){return this.receiptPaymentForm.get("account_no")}get expense_non_gst(){return this.receiptPaymentForm.get("non_gst")}get upi_id_receipt(){return this.receiptPaymentForm.get("upi_id")}get transaction_id_receipt(){return this.receiptPaymentForm.get("transaction_id")}get payment_account_receipt(){return this.receiptPaymentForm.get("payment_account")}receiptFormSubmit(){this.receiptPaymentForm.invalid?Object.keys(this.receiptPaymentForm.controls).forEach(e=>{this.receiptPaymentForm.controls[e].markAsTouched()}):"sales"===this.voucher_type.value?this.formSubmitReceipt():"purchase"===this.voucher_type.value?this.formSubmitPurchase():this.formSubmitExpense()}formSubmitExpense(){let e=new FormData;e.append("party",this.party_receipt?.value?.id),e.append("amount",this.amount_receipt.value),e.append("remarks",this.receipt_remark.value),e.append("non_gst",this.expense_non_gst.value),e.append("payment_account",this.payment_account_receipt.value),this.cartService.expensePayment(e).subscribe({next:a=>{a.success?(this.toastr.success(a.msg),this.receiptPaymentForm.reset(),document.querySelector(".receiptModalClose").click(),this.expense_non_gst.value(!1)):this.toastr.error(a.msg)},error:a=>{this.toastr.error(a.message)}})}formSubmitPurchase(){let e=new FormData;if("UPI"===this.payment_mode.value){let a={upi_no:Number(this.upi_id_receipt.value),payment_account:Number(this.payment_account_receipt.value)};"Advance"==this.payment_type.value?(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",JSON.stringify(a))):(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",JSON.stringify(a)))}else if("Bank"===this.payment_mode.value){let a={payment_account:Number(this.payment_account_receipt.value),account_no:this.receipt_account_no.value};"Advance"==this.payment_type.value?(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",JSON.stringify(a)),e.append("upi_detail","")):(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",JSON.stringify(a)),e.append("upi_detail",""))}else if("Card"===this.payment_mode.value){let a={payment_account:Number(this.payment_account_receipt.value),customer_bank_name:this.receipt_customer_bank_name.value,card_payment_amount:this.receipt_card_payment_amount.value,card_holder_name:this.receipt_card_holder_name.value,cart_transactions_no:this.receipt_cart_transactions_no.value};"Advance"==this.payment_type.value?(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",JSON.stringify(a)),e.append("bank_detail",""),e.append("upi_detail","")):(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",JSON.stringify(a)),e.append("bank_detail",""),e.append("upi_detail",""))}else"Advance"==this.payment_type.value?(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail","")):(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",""));this.cartService.purchasePayment(e).subscribe({next:a=>{a.success?(this.toastr.success(a.msg),this.receiptPaymentForm.reset(),document.querySelector(".receiptModalClose").click()):this.toastr.error(a.msg)},error:a=>{this.toastr.error(a.message)}})}formSubmitReceipt(){let e=new FormData;if("UPI"===this.payment_mode.value){let a={upi_no:Number(this.upi_id_receipt.value),payment_account:Number(this.payment_account_receipt.value)};"Advance"==this.payment_type.value?(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",JSON.stringify(a))):(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",JSON.stringify(a)))}else if("Bank"===this.payment_mode.value){let a={payment_account:Number(this.payment_account_receipt.value),account_no:this.receipt_account_no.value};"Advance"==this.payment_type.value?(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",JSON.stringify(a)),e.append("upi_detail","")):(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",JSON.stringify(a)),e.append("upi_detail",""))}else if("Card"===this.payment_mode.value){let a={payment_account:Number(this.payment_account_receipt.value),customer_bank_name:this.receipt_customer_bank_name.value,card_payment_amount:this.receipt_card_payment_amount.value,card_holder_name:this.receipt_card_holder_name.value,cart_transactions_no:this.receipt_cart_transactions_no.value};"Advance"==this.payment_type.value?(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",JSON.stringify(a)),e.append("bank_detail",""),e.append("upi_detail","")):(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",JSON.stringify(a)),e.append("bank_detail",""),e.append("upi_detail",""))}else"Advance"==this.payment_type.value?(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail","")):(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",""));this.cartService.receiptPayment(e).subscribe({next:a=>{a.success?(this.toastr.success(a.msg),this.receiptPaymentForm.reset(),document.querySelector(".receiptModalClose").click()):this.toastr.error(a.msg)},error:a=>{this.toastr.error(a.message)}})}saveAndNext(){}isFormValid(){}}return p.\u0275fac=function(e){return new(e||p)(s.Y36(f.u),s.Y36(t.qu),s.Y36(b._W),s.Y36(k.r),s.Y36(l.eN),s.Y36(V.v),s.Y36(I.p))},p.\u0275cmp=s.Xpm({type:p,selectors:[["app-payment"]],viewQuery:function(e,a){if(1&e&&s.Gf(N,5),2&e){let n;s.iGM(n=s.CRH())&&(a.tabGroup=n.first)}},decls:0,vars:0,template:function(e,a){}}),p})()}];let C=(()=>{class p{}return p.\u0275fac=function(e){return new(e||p)},p.\u0275mod=s.oAB({type:p}),p.\u0275inj=s.cJS({imports:[c.Bz.forChild(S),c.Bz]}),p})();var A=r(47957),M=r(44144),x=r(59549),q=r(3848),B=r(97392);let O=(()=>{class p{}return p.\u0275fac=function(e){return new(e||p)},p.\u0275mod=s.oAB({type:p}),p.\u0275inj=s.cJS({imports:[F.ez,C,t.u5,t.UX,A.Bb,x.lN,M.c,B.Ps,q.Nh]}),p})()}}]);
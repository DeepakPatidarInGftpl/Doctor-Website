"use strict";(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[3872],{23872:(L,o,r)=>{r.r(o),r.d(o,{PaymentModule:()=>B});var P=r(96814),c=r(74408),d=r(69862),a=r(56223),l=r(32181),u=r(93997),h=r(83620),y=r(99397),_=r(94664),v=r(26306),g=r(64716),n=r(19212),F=r(14655),f=r(58763),b=r(7765),k=r(49546),V=r(44293);const I=["tabGroup"],N=[{path:"",component:(()=>{class s{constructor(e,t,p,i,m,O,J){this.billHoldService=e,this.fb=t,this.toastr=p,this.syncService=i,this.http=m,this.cartService=O,this.coreService=J,this.voucherType=[{id:1,label:"Sales",value:"sales"},{id:2,label:"Purchase",value:"purchase"},{id:3,label:"Expense",value:"expense"},{id:4,label:"Cash in Hand",value:"cash in hand"}],this.paymentType=[{id:1,label:"Advance Payment",value:"Advance"},{id:2,label:"Against Bill",value:"Against Bill"}],this.paymentMode=[{id:1,label:"UPI",value:"UPI"},{id:2,label:"Card",value:"Card"},{id:3,label:"Cash",value:"Cash"},{id:4,label:"Bank",value:"Bank"}],this.receiptSales=[],this.companyBankList=[],this.partyIsLoading=!1,this.cusMinLengthTerm=3,this.cusIsLoading=!1,this.customerAutoCompleteControl2=new a.NI("")}ngOnInit(){this.recieptForm=this.fb.group({customer:new a.NI("",[a.kI.required]),receipt_method:new a.NI("",[a.kI.required]),payment_mode:new a.NI("",[a.kI.required]),amount:new a.NI("",[a.kI.required]),description:new a.NI("",[a.kI.required]),bill_no:new a.NI("",[a.kI.required]),card_detail:new a.NI("",[a.kI.required]),bank_detail:new a.NI("",[a.kI.required]),upi_detail:new a.NI("",[a.kI.required])});const p={headers:new d.WM({"Content-Type":"application/json",Authorization:"Token 4d586523c3dbbc989192bec34006e72a4edebf00"})};this.receiptPaymentForm=this.fb.group({voucher_type:["",[a.kI.required]],payment_type:[""],payment_mode:[""],receipt_sales:[""],amount_receipt:[""],customer_receipt:[""],party_receipt:[""],receipt_remark:[""],payment_account:[""],upi_id:[""],customer_bank_name:[""],card_payment_amount:[""],card_holder_name:[""],cart_transactions_no:[""],account_no:[""],non_gst:[!1]}),this.receiptPaymentForm.get("voucher_type").valueChanges.subscribe(i=>{"sales"===i?(this.receiptPaymentForm.get("payment_type").setValue(this.paymentType[0].value),this.receiptPaymentForm.get("payment_type").setValidators(a.kI.required),this.receiptPaymentForm.get("payment_mode").setValidators(a.kI.required),this.receiptPaymentForm.get("customer_receipt").setValidators(a.kI.required),this.receiptPaymentForm.get("amount_receipt").setValidators(a.kI.required),this.receiptPaymentForm.get("payment_account").setValidators(a.kI.required),this.receiptPaymentForm.get("receipt_remark").setValidators(a.kI.required)):"purchase"===i?(this.receiptPaymentForm.get("payment_type").setValue(this.paymentType[0].value),this.receiptPaymentForm.get("payment_type").setValidators(a.kI.required),this.receiptPaymentForm.get("payment_mode").setValidators(a.kI.required),this.receiptPaymentForm.get("party_receipt").setValidators(a.kI.required),this.receiptPaymentForm.get("receipt_remark").setValidators(a.kI.required),this.receiptPaymentForm.get("amount_receipt").setValidators(a.kI.required),this.receiptPaymentForm.get("payment_account").setValidators(a.kI.required)):"expense"===i?(this.receiptPaymentForm.get("upi_id").clearValidators(),this.receiptPaymentForm.get("payment_account").setValidators(a.kI.required),this.receiptPaymentForm.get("receipt_remark").setValidators(a.kI.required),this.receiptPaymentForm.get("non_gst").setValidators(a.kI.required),this.receiptPaymentForm.get("party_receipt").setValidators(a.kI.required),this.receiptPaymentForm.get("amount_receipt").setValidators(a.kI.required)):(this.receiptPaymentForm.get("payment_type").clearValidators(),this.receiptPaymentForm.get("payment_mode").clearValidators(),this.receiptPaymentForm.get("customer_receipt").clearValidators(),this.receiptPaymentForm.get("amount_receipt").clearValidators(),this.receiptPaymentForm.get("payment_account").clearValidators(),this.receiptPaymentForm.get("receipt_remark").clearValidators()),this.receiptPaymentForm.get("party_receipt").updateValueAndValidity(),this.receiptPaymentForm.get("non_gst").updateValueAndValidity(),this.receiptPaymentForm.get("payment_type").updateValueAndValidity(),this.receiptPaymentForm.get("payment_mode").updateValueAndValidity(),this.receiptPaymentForm.get("payment_account").updateValueAndValidity(),this.receiptPaymentForm.get("customer_receipt").updateValueAndValidity(),this.receiptPaymentForm.get("receipt_remark").updateValueAndValidity(),this.receiptPaymentForm.get("amount_receipt").updateValueAndValidity()}),this.receiptPaymentForm.get("payment_type").valueChanges.subscribe(i=>{this.receiptPaymentForm.get("payment_mode").setValue(this.paymentMode[0].value),"Against Bill"===i?this.receiptPaymentForm.get("receipt_sales").setValidators(a.kI.required):this.receiptPaymentForm.get("receipt_sales").clearValidators(),this.receiptPaymentForm.get("receipt_sales").updateValueAndValidity()}),this.receiptPaymentForm.get("payment_mode").valueChanges.subscribe(i=>{"UPI"===i?(this.receiptPaymentForm.get("upi_id").setValidators(a.kI.required),this.receiptPaymentForm.get("payment_account").setValidators(a.kI.required)):"Card"===i?(this.receiptPaymentForm.get("customer_bank_name").setValidators(a.kI.required),this.receiptPaymentForm.get("card_payment_amount").setValidators(a.kI.required),this.receiptPaymentForm.get("card_holder_name").setValidators(a.kI.required),this.receiptPaymentForm.get("cart_transactions_no").setValidators(a.kI.required),this.receiptPaymentForm.get("payment_account").setValidators(a.kI.required)):"Bank"===i?this.receiptPaymentForm.get("account_no").setValidators(a.kI.required):(this.receiptPaymentForm.get("upi_id").clearValidators(),this.receiptPaymentForm.get("payment_account").clearValidators(),this.receiptPaymentForm.get("customer_bank_name").clearValidators(),this.receiptPaymentForm.get("card_payment_amount").clearValidators(),this.receiptPaymentForm.get("card_holder_name").clearValidators(),this.receiptPaymentForm.get("cart_transactions_no").clearValidators(),this.receiptPaymentForm.get("account_no").clearValidators()),this.receiptPaymentForm.get("upi_id").updateValueAndValidity(),this.receiptPaymentForm.get("payment_account").updateValueAndValidity(),this.receiptPaymentForm.get("customer_bank_name").updateValueAndValidity(),this.receiptPaymentForm.get("card_payment_amount").updateValueAndValidity(),this.receiptPaymentForm.get("card_holder_name").updateValueAndValidity(),this.receiptPaymentForm.get("cart_transactions_no").updateValueAndValidity(),this.receiptPaymentForm.get("account_no").updateValueAndValidity()}),this.receiptPaymentForm.get("customer_receipt").valueChanges.pipe((0,l.h)(i=>null!==i&&i?.length>=this.cusMinLengthTerm),(0,u.x)(),(0,h.b)(100),(0,y.b)(()=>{this.cusErrorMsg="",this.filteredCustomer2=[],this.cusIsLoading=!0}),(0,_.w)(i=>this.http.get(`https://pv.greatfuturetechno.com/pv-api/pos/customer_filter/?search=${i}`,p).pipe((0,v.K)(m=>(this.cusErrorMsg="No Customer Found",this.cusIsLoading=!1,[])),(0,g.x)(()=>{this.cusIsLoading=!1})))).subscribe(i=>{i.length>0?this.filteredCustomer2=i:(this.filteredCustomer2=[],this.cusErrorMsg="No Customers Found")}),this.receiptPaymentForm.get("party_receipt").valueChanges.pipe((0,l.h)(i=>null!==i&&i?.length>=this.cusMinLengthTerm),(0,u.x)(),(0,h.b)(100),(0,y.b)(()=>{this.partyErrorMsg="",this.filteredParty=[],this.partyIsLoading=!0}),(0,_.w)(i=>this.http.get(`https://pv.greatfuturetechno.com/pv-api/pos/party_filter/?search=${i}`,p).pipe((0,v.K)(m=>(this.partyErrorMsg="No Party Found",this.partyIsLoading=!1,[])),(0,g.x)(()=>{this.partyIsLoading=!1})))).subscribe(i=>{i.length>0?this.filteredParty=i:(this.filteredParty=[],this.partyErrorMsg="No Party Found")}),this.cartService.getCompanyBank().subscribe({next:i=>{this.companyBankList=i},error:i=>{}})}optionSelectedParty(e){}optionSelectedReceipt(e){this.cartService.getReceiptDueOrder(e.option.value.id).subscribe({next:p=>{this.receiptSales=p},error:p=>{}})}displayCus(e){return e?e.mobile_no:""}displayParty(e){return e?e.mobile_no:""}get voucher_type(){return this.receiptPaymentForm.get("voucher_type")}get payment_type(){return this.receiptPaymentForm.get("payment_type")}get payment_mode(){return this.receiptPaymentForm.get("payment_mode")}get receipt_sales(){return this.receiptPaymentForm.get("receipt_sales")}get amount_receipt(){return this.receiptPaymentForm.get("amount_receipt")}get customer_receipt(){return this.receiptPaymentForm.get("customer_receipt")}get receipt_remark(){return this.receiptPaymentForm.get("receipt_remark")}get party_receipt(){return this.receiptPaymentForm.get("party_receipt")}get receipt_customer_bank_name(){return this.receiptPaymentForm.get("customer_bank_name")}get receipt_card_payment_amount(){return this.receiptPaymentForm.get("card_payment_amount")}get receipt_card_holder_name(){return this.receiptPaymentForm.get("card_holder_name")}get receipt_cart_transactions_no(){return this.receiptPaymentForm.get("cart_transactions_no")}get receipt_account_no(){return this.receiptPaymentForm.get("account_no")}get expense_non_gst(){return this.receiptPaymentForm.get("non_gst")}get upi_id_receipt(){return this.receiptPaymentForm.get("upi_id")}get transaction_id_receipt(){return this.receiptPaymentForm.get("transaction_id")}get payment_account_receipt(){return this.receiptPaymentForm.get("payment_account")}receiptFormSubmit(){this.receiptPaymentForm.invalid?Object.keys(this.receiptPaymentForm.controls).forEach(e=>{this.receiptPaymentForm.controls[e].markAsTouched()}):"sales"===this.voucher_type.value?this.formSubmitReceipt():"purchase"===this.voucher_type.value?this.formSubmitPurchase():this.formSubmitExpense()}formSubmitExpense(){let e=new FormData;e.append("party",this.party_receipt?.value?.id),e.append("amount",this.amount_receipt.value),e.append("remarks",this.receipt_remark.value),e.append("non_gst",this.expense_non_gst.value),e.append("payment_account",this.payment_account_receipt.value),this.cartService.expensePayment(e).subscribe({next:t=>{t.success?(this.toastr.success(t.msg),this.receiptPaymentForm.reset(),document.querySelector(".receiptModalClose").click(),this.expense_non_gst.value(!1)):this.toastr.error(t.msg)},error:t=>{this.toastr.error(t.message)}})}formSubmitPurchase(){let e=new FormData;if("UPI"===this.payment_mode.value){let t={upi_no:Number(this.upi_id_receipt.value),payment_account:Number(this.payment_account_receipt.value)};"Advance"==this.payment_type.value?(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",JSON.stringify(t))):(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",JSON.stringify(t)))}else if("Bank"===this.payment_mode.value){let t={payment_account:Number(this.payment_account_receipt.value),account_no:this.receipt_account_no.value};"Advance"==this.payment_type.value?(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",JSON.stringify(t)),e.append("upi_detail","")):(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",JSON.stringify(t)),e.append("upi_detail",""))}else if("Card"===this.payment_mode.value){let t={payment_account:Number(this.payment_account_receipt.value),customer_bank_name:this.receipt_customer_bank_name.value,card_payment_amount:this.receipt_card_payment_amount.value,card_holder_name:this.receipt_card_holder_name.value,cart_transactions_no:this.receipt_cart_transactions_no.value};"Advance"==this.payment_type.value?(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",JSON.stringify(t)),e.append("bank_detail",""),e.append("upi_detail","")):(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",JSON.stringify(t)),e.append("bank_detail",""),e.append("upi_detail",""))}else"Advance"==this.payment_type.value?(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail","")):(e.append("party",this.party_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",""));this.cartService.purchasePayment(e).subscribe({next:t=>{t.success?(this.toastr.success(t.msg),this.receiptPaymentForm.reset(),document.querySelector(".receiptModalClose").click()):this.toastr.error(t.msg)},error:t=>{this.toastr.error(t.message)}})}formSubmitReceipt(){let e=new FormData;if("UPI"===this.payment_mode.value){let t={upi_no:Number(this.upi_id_receipt.value),payment_account:Number(this.payment_account_receipt.value)};"Advance"==this.payment_type.value?(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",JSON.stringify(t))):(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",JSON.stringify(t)))}else if("Bank"===this.payment_mode.value){let t={payment_account:Number(this.payment_account_receipt.value),account_no:this.receipt_account_no.value};"Advance"==this.payment_type.value?(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",JSON.stringify(t)),e.append("upi_detail","")):(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",JSON.stringify(t)),e.append("upi_detail",""))}else if("Card"===this.payment_mode.value){let t={payment_account:Number(this.payment_account_receipt.value),customer_bank_name:this.receipt_customer_bank_name.value,card_payment_amount:this.receipt_card_payment_amount.value,card_holder_name:this.receipt_card_holder_name.value,cart_transactions_no:this.receipt_cart_transactions_no.value};"Advance"==this.payment_type.value?(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",JSON.stringify(t)),e.append("bank_detail",""),e.append("upi_detail","")):(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",JSON.stringify(t)),e.append("bank_detail",""),e.append("upi_detail",""))}else"Advance"==this.payment_type.value?(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",""),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail","")):(e.append("customer",this.customer_receipt?.value?.id),e.append("receipt_method",this.payment_type.value),e.append("payment_mode",this.payment_mode.value),e.append("amount",this.amount_receipt.value),e.append("description",this.receipt_remark.value),e.append("bill_no",this.receipt_sales.value),e.append("card_detail",""),e.append("bank_detail",""),e.append("upi_detail",""));this.cartService.receiptPayment(e).subscribe({next:t=>{t.success?(this.toastr.success(t.msg),this.receiptPaymentForm.reset(),document.querySelector(".receiptModalClose").click()):this.toastr.error(t.msg)},error:t=>{this.toastr.error(t.message)}})}saveAndNext(){}isFormValid(){}static#e=this.\u0275fac=function(t){return new(t||s)(n.Y36(F.u),n.Y36(a.qu),n.Y36(f._W),n.Y36(b.r),n.Y36(d.eN),n.Y36(k.v),n.Y36(V.p))};static#t=this.\u0275cmp=n.Xpm({type:s,selectors:[["app-payment"]],viewQuery:function(t,p){if(1&t&&n.Gf(I,5),2&t){let i;n.iGM(i=n.CRH())&&(p.tabGroup=i.first)}},decls:0,vars:0,template:function(t,p){}})}return s})()}];let S=(()=>{class s{static#e=this.\u0275fac=function(t){return new(t||s)};static#t=this.\u0275mod=n.oAB({type:s});static#a=this.\u0275inj=n.cJS({imports:[c.Bz.forChild(N),c.Bz]})}return s})();var A=r(24630),C=r(2032),x=r(19157),M=r(74104),q=r(30617);let B=(()=>{class s{static#e=this.\u0275fac=function(t){return new(t||s)};static#t=this.\u0275mod=n.oAB({type:s});static#a=this.\u0275inj=n.cJS({imports:[P.ez,S,a.u5,a.UX,A.Bb,x.lN,C.c,q.Ps,M.Nh]})}return s})()}}]);
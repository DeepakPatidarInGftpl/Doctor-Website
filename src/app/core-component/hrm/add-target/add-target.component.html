<div class="page-header justify-content-center">
    <div class="page-title">
        <h4>Target Add</h4>
        <h6>Create new Target</h6>
    </div>
</div>


<!-- /add -->
<form [formGroup]="targetForm" (ngSubmit)="submit()">
    <div class="row">
        <div class="card ">
            <div class="card-body">
                <div class="row form-card">
                    <div class="col-lg-3 col-sm-4 col-12">
                        <div class="form-group">
                            <label>Department*</label>
                            <select class="form-select" formControlName="department" [ngClass]="{
                        'is-invalid': f['department'].touched && f['department'].invalid}">
                                <option value="" selected disabled>Select department</option>
                                <option value="{{department.id}}" *ngFor="let department of departmentList">
                                    {{department?.title}}
                                </option>
                            </select>
                            <span class="text-danger"
                                *ngIf="department && department.invalid && department.touched">Select Department </span>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-4 col-12">
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" formControlName="start_date" id="start_date" (change)="onCheck()"
                                [ngClass]="{'is-invalid': f['start_date'].touched && f['start_date'].invalid}">
                            <span class="text-danger"
                                *ngIf="start_date && start_date.invalid && start_date.touched">Select Start Date</span>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-4 col-12">
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" formControlName="end_date" id="end_date" (change)="onCheck()"
                                [ngClass]="{'is-invalid': f['end_date'].touched && f['end_date'].invalid}">
                            <span class="text-danger" *ngIf="end_date && end_date.invalid && end_date.touched">Select
                                End Date</span>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-4 col-12">
                        <div class="form-group">
                            <label>Target Value</label>
                            <input type="number" formControlName="target_value" id="target_value"
                                [ngClass]="{'is-invalid': f['target_value'].touched && f['target_value'].invalid}">
                            <span class="text-danger"
                                *ngIf="target_value && target_value.invalid && target_value.touched">Select Target
                                Value</span>
                        </div>

                    </div>
                    <div class="col-lg-3 col-sm-3 col-12">
                        <div class="form-group">
                            <label>Employee Type*</label>
                            <select formControlName="employee_type" id="employee_type"
                                [ngClass]="{'is-invalid': f['employee_type'].touched && f['employee_type'].invalid}">
                                <option value="" selected disabled>Select Employee Type</option>
                                <option value="Fresher">Fresher</option>
                                <option value="Experienced">Experienced</option>
                                <option value="Master">Master</option>
                            </select>
                            <span class="text-danger d-block"
                                *ngIf="employee_type && employee_type.invalid && employee_type.touched">Select Employee
                                Type</span>
                        </div>
                    </div>
                    <div class="col-lg-12 col-sm-12 col-12">
                        <table class="table amt-table">
                            <thead>
                                <tr>
                                    <th>Sr. No.</th>
                                    <th>Month</th>
                                    <th class="d-flex align-items-center">Percentage (%)
                                        <i class="ion-information circle ms-2" data-bs-toggle="tooltip"
                                            title="Put the value from 1 to 100, based on your expectations of revenue generation for this month, where 1 is equals to 1% and 100 is equals to 100%. But keep in mind that the sum of the values of all fields must be equal to 100."></i>
                                    </th>
                                    <th>Sale Value</th>
                                    <th>&nbsp;</th>
                                </tr>
                            </thead>
                            <tbody>
                                <ng-container formArrayName="cart">
                                    <ng-container *ngFor="let d of getCart().controls; let i=index">
                                        <tr [formGroupName]="i">
                                            <td>{{i+1}}</td>
                                            <td>
                                                <input type="text" class="form-control" placeholder="Months Name"
                                                    formControlName="month_and_year" />
                                            </td>
                                            <td>
                                                <input type="text" formControlName="percent_of_total_target"
                                                    (blur)="calculateSaleValue(i)" class="form-control"
                                                    placeholder="ex-100">
                                                <span class="text-danger" style="display: block;"
                                                    *ngIf="discountt(i) && discountt(i).invalid && discountt(i).touched">Enter
                                                    Percentage(%) ex: 1-100 % </span>
                                            </td>
                                            <td>
                                                <input type="text" formControlName="estimated_sale_value"
                                                    (blur)="calculatePercentage(i)" class="form-control"
                                                    placeholder="ex-100">
                                            </td>
                                            <!-- <td>
                                                <button (click)="removeCart(i)" class="btn" style="background: #FF9F43;">&#8722;</button>
                                            </td> -->
                                        </tr>
                                    </ng-container>
                                </ng-container>
                                <tr style=" background: rgba(145, 158, 171, 0.32);">
                                    <td class="text-start" colspan="2"><strong>Total</strong></td>
                                    <td>{{percentageValue()}}</td>
                                    <td> {{saleValue()?.toFixed(2) }}</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- <div class="w-100 text-right">
                            <span (click)="addCart()" class="addMore">+ Add more</span>
                        </div> -->
                    </div>
                    <div class="col-lg-8 text-end mt-5">
                        <button class="btn btn-submit me-2" *ngIf="!loaders">Submit</button>
                        <button class="btn btn-submit me-2" type="submit" *ngIf="loaders" disabled>
                            <span class="spinner-border spinner-border-sm" role="status"
                                aria-hidden="true"></span>&nbsp; Submit</button>
                        <a routerLink="//hrm/list-target" class="btn btn-cancel">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<!-- /add -->